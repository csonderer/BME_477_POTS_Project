<!DOCTYPE html>

<!-- Source code for client manipulation based on example code provided by SMART Health IT
	 CSS template created by TEMPLATED. Template has been modified
-->

<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
	<title>POTS App</title>
	<link rel="stylesheet" href="main.css">
	<link rel="stylesheet" href="_setup.css">
</head>

<body onload="readSymptoms()">	
	<!-- Header --> 
	<section id="banner">
		<p>Settings</p>
		<ul class="actions">
			<li><a href="index.html" class="button special">Back to Home</a><li>
		</ul>
	</section>
	
	<!-- Symptom Tracking -->
	<section id="one" class="wrapper special">
		<div class="inner">
			<header class="major">
				<h2>Symptom Tracker</h2>
			</header>		
			<p>Which symptoms would you like to track?</p>
			<form autocomplete="off" action="/action_page.php">
				<div class="autocomplete" style="width: 300px;">
				<input id="myInput2" type="text" name="mySymptom" placeholder="Add Symptom">
				</div>
				<input type="button" id="button2" value="Add" onclick="displaySymptom()"></input>
			</form>
			<br><br><br>
			<header class="major">
				<h2>Current Symptoms Being Tracked</h2>
			</header>
			<ul id="symptom_list"></ul>
		</div>
	</section>
	
	<!-- Two -->
	<section id="two" class="wrapper style2 special">
		<div class="inner narrow">
     		<p>CSS template created by TEMPLATED. <br> This CSS template has been modified.</p>
		</div>
	</section>
	
	<!--
	<h2>Medication Tracker</h2>
	<p>Here is your list of current medications:</p>
	<ul id="med_list"></ul>

	<form autocomplete="off">
        <div class="autocomplete" style="width:300px;">
            <input id="myInput1" type="text" name="myMedication" placeholder="Add Medication">
        </div>
        <input type="button" id="button1" value="Add" onclick="JavaScript:addMedication()"></input>
        <div id="Result"></div>
    </form>
    <script>
        function autocomplete(inp, arr) {
            /*the autocomplete function takes in the text field element and an array of possible values*/
            var currentFocus;
            /*execute a function when someone writes in the text field:*/
            inp.addEventListener("input", function(e) {
                var a, b, i, val = this.value;
                /*close any already open lists of autocompleted values*/
                closeAllLists();
                if (!val) {
                    return false;
                }
                currentFocus = -1;
                /*create DIV element that will contain the items (values):*/
                a = document.createElement("DIV");
                a.setAttribute("id", this.id + "autocomplete-list");
                a.setAttribute("class", "autocomplete-items");
                /*append the DIV element as a child of the autocomplete container:*/
                this.parentNode.appendChild(a);
                for (i = 0; i < arr.length; i++) {
                    /*check if the item starts with the same letters as the text field value*/
                    if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                        /*create DIV element for each matching element:*/
                        b = document.createElement("DIV");
                        /*make the matching letters bold*/
                        b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                        b.innerHTML += arr[i].substr(val.length);
                        /*insert an input field that will hold the current array item's value*/
                        b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                        /*execute a function when someone clicks on the item value (DIV element)*/
                        b.addEventListener("click", function(e) {
                            /*insert the value for the autocomplete text field:*/
                            inp.value = this.getElementsByTagName("input")[0].value;
                            /*close the list of autocompleted values, or any other open lists of autocompleted values*/
                            closeAllLists();
                        });
                        a.appendChild(b);
                    }
                }
            });
            /*execute a function presses a key on the keyboard*/
            inp.addEventListener("keydown", function(e) {
                var x = document.getElementById(this.id + "autocomplete-list");
                if (x) x = x.getElementsByTagName("div");
                if (e.keyCode == 40) {
                    /*if the arrow DOWN key is pressed, increase current focus variable and make current item more visible*/
                    currentFocus++;
                    addActive(x);
                } else if (e.keyCode == 38) {
                    currentFocus--;
                    addActive(x);
                } else if (e.keyCode == 13) {
                    e.preventDefault(); /*prevent submit if ENTER is pressed, and click active item*/
                    if (currentFocus > -1) {
                        if (x) x[currentFocus].click();
                    }
                }
            });

            function addActive(x) {
                /*function to classify an item as active*/
                if (!x) return false;
                removeActive(x); /*remove active class on all items*/
                if (currentFocus >= x.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (x.length - 1);
                x[currentFocus].classList.add("autocomplete-active"); /*to add the class*/
            }

            function removeActive(x) {
                /*remove the active class from all autocomplete items*/
                for (var i = 0; i < x.length; i++) {
                    x[i].classList.remove("autocomplete-active");
                }
            }

            function closeAllLists(element) {
                /*close all autocomplete lists in document except the one passed as argument*/
                var x = document.getElementsByClassName("autocomplete-items");
                for (var i = 0; i < x.length; i++) {
                    if (element != x[i] && element != inp) {
                        x[i].parentNode.removeChild(x[i]);
                    }
                }
            }
            /*execute function when someone clicks in the document*/
            document.addEventListener("click", function(e) {
                closeAllLists(e.target);
            });
        }
        /*An array containing medications used to treat POTS symptoms*/
        var medications = ["Midodrine", "Metoprolol", "Atenolol", "Tegaserod",
            "Polyethylene glycol (Miralax)", "Fludrocortisone (Florinef)",
            "Erythropoietin (Epoetin alfa, Epogen, Procrit, Darbepoietin alfa, Arnesp",
            "Pyridostigmine (Mestinon)", "Diltiazem (Cardizem, Tiazac, Cartia XT",
            "Ivabradine (Corlanor)", "Propranolol (Hemangeol, Inderal XL, InnoPran XL",
            "Droxidopa (Northera)"
        ];
        /*initiate the autocomplete function on the "myInput" element, and pass along 
        the medications array as possible autocomplete values*/
        autocomplete(document.getElementById("myInput1"), medications);
    </script> -->

	<script> 	
        function autocomplete(inp, arr) {
            /*the autocomplete function takes in the text field element and an array of possible values*/
            var currentFocus;
            /*execute a function when someone writes in the text field:*/
            inp.addEventListener("input", function(e) {
                var a, b, i, val = this.value;
                /*close any already open lists of autocompleted values*/
                closeAllLists();
                if (!val) {
                    return false;
                }
                currentFocus = -1;
                /*create DIV element that will contain the items (values):*/
                a = document.createElement("DIV");
                a.setAttribute("id", this.id + "autocomplete-list");
                a.setAttribute("class", "autocomplete-items");
                /*append the DIV element as a child of the autocomplete container:*/
                this.parentNode.appendChild(a);
                for (i = 0; i < arr.length; i++) {
                    /*check if the item starts with the same letters as the text field value*/
                    if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                        /*create DIV element for each matching element:*/
                        b = document.createElement("DIV");
                        /*make the matching letters bold*/
                        b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                        b.innerHTML += arr[i].substr(val.length);
                        /*insert an input field that will hold the current array item's value*/
                        b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                        /*execute a function when someone clicks on the item value (DIV element)*/
                        b.addEventListener("click", function(e) {
                            /*insert the value for the autocomplete text field:*/
                            inp.value = this.getElementsByTagName("input")[0].value;
                            /*close the list of autocompleted values, or any other open lists of autocompleted values*/
                            closeAllLists();
                        });
                        a.appendChild(b);
                    }
                }
            });
            /*execute a function presses a key on the keyboard*/
            inp.addEventListener("keydown", function(e) {
                var x = document.getElementById(this.id + "autocomplete-list");
                if (x) x = x.getElementsByTagName("div");
                if (e.keyCode == 40) {
                    /*if the arrow DOWN key is pressed, increase current focus variable and make current item more visible*/
                    currentFocus++;
                    addActive(x);
                } else if (e.keyCode == 38) {
                    currentFocus--;
                    addActive(x);
                } else if (e.keyCode == 13) {
                    e.preventDefault(); /*prevent submit if ENTER is pressed, and click active item*/
                    if (currentFocus > -1) {
                        if (x) x[currentFocus].click();
                    }
                }
            });

            function addActive(x) {
                /*function to classify an item as active*/
                if (!x) return false;
                removeActive(x); /*remove active class on all items*/
                if (currentFocus >= x.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = (x.length - 1);
                x[currentFocus].classList.add("autocomplete-active"); /*to add the class*/
            }

            function removeActive(x) {
                /*remove the active class from all autocomplete items*/
                for (var i = 0; i < x.length; i++) {
                    x[i].classList.remove("autocomplete-active");
                }
            }

            function closeAllLists(element) {
                /*close all autocomplete lists in document except the one passed as argument*/
                var x = document.getElementsByClassName("autocomplete-items");
                for (var i = 0; i < x.length; i++) {
                    if (element != x[i] && element != inp) {
                        x[i].parentNode.removeChild(x[i]);
                    }
                }
            }
            /*execute function when someone clicks in the document*/
            document.addEventListener("click", function(e) {
                closeAllLists(e.target);
            });
        }
        /*An array containing common POTS symptoms including SNOMED terminology in parentheses if different*/
        var symptoms = ["Pain (chronic pain)", "Fatigue", "Diarrhea", "Constipation",
            "Vomiting", "Nausea", "Dizziness", "Lightheadedness", "Fainting (Syncope)",
            "Near fainting (Near syncope)", "GI Symptoms", "Muscle/Joint Pain", "Headache", "Light sensitivity (eyes sensitive to light)",
            "Noise sensitivity (Noise intolerance)", "Insomnia", "Vertigo",
            "Temperature sensitivity (Sensitive to changes in ambient temperature)",
            "Weakness (asthenia)", "Heart racing (tachycardia)", "Chest pain",
            "Shortness of breath (dyspnea)", "Migraine", "Anxiety",
            "Depression (symptoms of depression)", "Tremor", "Brain fog (forgetful)",
            "Concentration difficulty (unable to concentrate)"
        ];
        /*initiate the autocomplete function on the "myInput" element, and pass along 
        the symptoms array as possible autocomplete values*/
        autocomplete(document.getElementById("myInput2"), symptoms);
        
        function displaySymptom() {
        	// Display added symptoms
        	var symptom_list = document.getElementById("symptom_list");
        	var symptomToAdd = document.getElementById("myInput2").value;
        	
        	symptom_list.innerHTML += "<li>" + symptomToAdd + "</li>";   
        	
        	writeSymptoms();
        }   
        
     	// Read symptoms
    	function readSymptoms() {
    		var ajax = new XMLHttpRequest(); 
    		var symptoms = ""; // Holds JS array of symptom strings
    		var result = ""; // Holds string to be returned to HTML page
    		
    		ajax.open("GET", "_setup.php?read=1", true); // Arguments: method, url, async
    		ajax.send();

    		// Use AJAX to get an array of image urls
    		ajax.onreadystatechange = function() {
    			// If the server is ready and there are no errors
    			if (ajax.readyState == 4 && ajax.status == 200) {		
    				// Parse AJAX to get a Javascript array of all the symptom strings
    				symptoms = JSON.parse(ajax.responseText);
    				
    				// Format all the symptom strings to be HTML list elements
    				for (var i = 0; i < symptoms.length; i++) {
    					result += "<li>" + symptoms[i] + "</li>";
    				}
    				
    				// Change the inner HTML of the ul on the webpage
    				symptom_list.innerHTML = result;
    			} // End if statement
    		}; // End anonymous function
    	}
    	
    	// Write symptoms
    	function writeSymptoms() {
    		var ajax = new XMLHttpRequest(); 
    		var symptoms = ""; // Holds JS array of symptom strings
    		var result = ""; // Holds string to be returned to HTML page
    		var symptomToAdd = document.getElementById("myInput2").value;
    		
    		ajax.open("GET", "_setup.php?write=1&symptom=" + symptomToAdd, true); // Arguments: method, url, async
    		ajax.send();

    		// Use AJAX to get an array of image urls
    		ajax.onreadystatechange = function() {
    			// If the server is ready and there are no errors
    			if (ajax.readyState == 4 && ajax.status == 200) {		
    				
    			} // End if statement
    		}; // End anonymous function
    	}
    </script>
</html>